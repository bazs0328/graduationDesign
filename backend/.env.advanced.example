# GradTutor advanced configuration template (fallback).
# Prefer frontend: 设置中心 -> 高级设置与诊断 -> 系统高级参数（可编辑）.
# Keep this file for server-only/headless deployments.

# --- Core app ---
APP_NAME=GradTutor
DATA_DIR=data
AUTH_SECRET_KEY=gradtutor-dev-secret
AUTH_TOKEN_TTL_HOURS=72
AUTH_REQUIRE_LOGIN=true
AUTH_ALLOW_LEGACY_USER_ID=false

# --- Provider selection ---
# Supported: auto, openai, gemini, deepseek, qwen
LLM_PROVIDER=auto
# Supported: auto, openai, gemini, deepseek, qwen, dashscope
EMBEDDING_PROVIDER=auto

# --- OpenAI ---
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# --- Gemini (Google) ---
GOOGLE_API_KEY=
GEMINI_MODEL=gemini-1.5-flash
GEMINI_EMBEDDING_MODEL=text-embedding-004

# --- DeepSeek (OpenAI-compatible) ---
DEEPSEEK_API_KEY=
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat
# Optional. If empty, deepseek embedding falls back to openai/dashscope/gemini.
DEEPSEEK_EMBEDDING_MODEL=

# --- Qwen (DashScope OpenAI-compatible) ---
QWEN_API_KEY=
QWEN_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
QWEN_MODEL=qwen-plus
QWEN_EMBEDDING_MODEL=text-embedding-v4

# --- DashScope multi-modal embedding (uses QWEN_API_KEY) ---
DASHSCOPE_EMBEDDING_MODEL=qwen3-vl-embedding
# Optional. For international endpoint:
# https://dashscope-intl.aliyuncs.com/api/v1
DASHSCOPE_BASE_URL=

# --- Indexing & retrieval ---
CHUNK_SIZE=1000
CHUNK_OVERLAP=150
INDEX_TEXT_CLEANUP_ENABLED=true
INDEX_TEXT_CLEANUP_MODE=conservative
INDEX_TEXT_CLEANUP_NON_PDF_MODE=structure_preserving
NOISE_FILTER_LEVEL=balanced
NOISE_DROP_LOW_QUALITY_HITS=true
LEXICAL_STOPWORDS_ENABLED=true
LEXICAL_STOPWORDS_GLOBAL_PATH=data/lexical/stopwords.txt
LEXICAL_USERDICT_GLOBAL_PATH=data/lexical/userdict.txt
LEXICAL_STOPWORDS_KB_REL_PATH=rag_storage/lexicon/stopwords.txt
LEXICAL_USERDICT_KB_REL_PATH=rag_storage/lexicon/userdict.txt
LEXICAL_TOKENIZER_VERSION=v2

# --- OCR & parser ---
OCR_ENABLED=true
OCR_ENGINE=rapidocr
OCR_FALLBACK_ENGINES=rapidocr
OCR_LANGUAGE=chi_sim+eng
OCR_TESSERACT_LANGUAGE=
OCR_MIN_TEXT_LENGTH=10
OCR_RENDER_DPI=360
OCR_CHECK_PAGES=3
OCR_PREPROCESS_ENABLED=true
OCR_DESKEW_ENABLED=true
OCR_LOW_CONFIDENCE_THRESHOLD=0.78
PDF_PARSER_MODE=auto
PDF_GARBLED_OCR_ENABLED=true
PDF_GARBLED_OCR_FORCE=true
PDF_GARBLED_OCR_MIN_LEN_RATIO=0.30
PDF_GARBLED_SINGLE_CHAR_LINE_RATIO=0.45
PDF_GARBLED_SHORT_LINE_RATIO=0.65

# --- Quiz context reconstruction ---
QUIZ_CONTEXT_RECONSTRUCT_ENABLED=true
QUIZ_CONTEXT_SEED_K_MULTIPLIER=2.0
QUIZ_CONTEXT_NEIGHBOR_WINDOW=2
QUIZ_CONTEXT_PASSAGE_TARGET_CHARS=900
QUIZ_CONTEXT_FRAGMENT_FILTER_ENABLED=true

# --- QA & ranking ---
QA_TOP_K=4
QA_FETCH_K=12
QA_BM25_K=6
QA_SUMMARY_AUTO_EXPAND_ENABLED=true
QA_SUMMARY_TOP_K=8
QA_SUMMARY_FETCH_K=28
RAG_MODE=hybrid
RAG_DENSE_WEIGHT=0.7
RAG_BM25_WEIGHT=0.3
