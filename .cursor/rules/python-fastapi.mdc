---
description: Python/FastAPI 编码规范（PEP、Pydantic、async、测试），来源 araguaci/cursor-skills
globs: backend/**/*.py, tests/**/*.py
alwaysApply: false
---

# Python / FastAPI 约定

## 代码风格
- 遵循 PEP 8；使用 Black 格式化、isort 排序 import。
- 函数与类必须有 docstring；尽量使用 type hints。
- 优先使用 `async def` 处理 I/O；同步阻塞逻辑放 `run_in_executor`。

## FastAPI
- 路由层只做参数校验与调用 service，业务在 services/。
- 请求/响应用 Pydantic 模型，放在 schemas.py。
- 依赖注入优先使用 `Depends()`；配置从 core.config 读取。

## 错误与日志
- 业务异常使用 `HTTPException` 并统一 status code（404/409 等）。
- 记录错误用 `logger.exception`，不要 `print`。
- 输入校验失败由 Pydantic 自动返回 422；不重复手写校验逻辑。

## 测试
- 用 pytest；fixtures 放在 conftest.py。
- API 测试覆盖正常与异常路径；mock LLM 等外部依赖。
- 覆盖率目标 80%；与 backend-conventions 保持一致。
